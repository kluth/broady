<mat-card class="hotkey-config">
  <mat-card-header class="config-header">
    <mat-card-title>
      <mat-icon>keyboard</mat-icon>
      Keyboard Shortcuts
    </mat-card-title>
    <div class="header-actions">
      <button mat-stroked-button (click)="resetToDefaults()">
        <mat-icon>restart_alt</mat-icon>
        Reset to Defaults
      </button>
      <button mat-stroked-button (click)="exportConfig()">
        <mat-icon>download</mat-icon>
        Export
      </button>
    </div>
  </mat-card-header>

  <mat-divider></mat-divider>

  <mat-card-content>
    <mat-form-field appearance="outline" class="search-bar full-width">
      <mat-label>Search hotkeys</mat-label>
      <input
        matInput
        type="text"
        placeholder="Search hotkeys..."
        [value]="searchQuery()"
        (input)="updateSearch($any($event.target).value)"
      />
      <mat-icon matPrefix>search</mat-icon>
    </mat-form-field>

    @if (recordingAction()) {
    <div class="recording-overlay">
      <div class="recording-modal">
        <h4>Press a key combination</h4>
        @if (recordedKeys()) {
          <div class="recorded-key">
            {{ getHotkeyString(recordedKeys()!) }}
          </div>
        } @else {
          <div class="recording-indicator">
            <div class="pulse"></div>
            <span>Listening...</span>
          </div>
        }
        <button mat-button (click)="stopRecording()">
          Cancel
        </button>
      </div>
    </div>
    }

    <div class="config-content">
    @for (category of filteredCategories(); track category.name) {
      <div class="hotkey-category">
        <h4 class="category-name">{{ category.name }}</h4>
        <div class="actions-list">
          @for (action of category.actions; track action.id) {
            <div class="action-row">
              <div class="action-info">
                <div class="action-name">{{ action.name }}</div>
                <div class="action-description">{{ action.description }}</div>
              </div>
              <div class="action-hotkey">
                <mat-chip
                  class="hotkey-chip"
                  (click)="startRecording(action.id)"
                  [class.recording]="recordingAction() === action.id"
                >
                  @if (action.defaultHotkey) {
                    {{ getHotkeyString(action.defaultHotkey) }}
                  } @else {
                    <span class="no-hotkey">Not assigned</span>
                  }
                </mat-chip>
                @if (action.defaultHotkey) {
                  <button
                    mat-icon-button
                    (click)="clearHotkey(action.id)"
                    matTooltip="Clear hotkey"
                    color="warn"
                  >
                    <mat-icon>close</mat-icon>
                  </button>
                }
              </div>
            </div>
          }
        </div>
      </div>
    } @empty {
      <div class="no-results">
        <mat-icon class="empty-icon">search_off</mat-icon>
        <p>No hotkeys found matching "{{ searchQuery() }}"</p>
      </div>
    }
    </div>
  </mat-card-content>
</mat-card>
