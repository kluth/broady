@if (isOpen()) {
  <div class="settings-overlay" (click)="close()">
    <mat-card class="settings-dialog" (click)="$event.stopPropagation()">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>settings</mat-icon>
          Settings
        </mat-card-title>
        <button mat-icon-button class="close-button" (click)="close()">
          <mat-icon>close</mat-icon>
        </button>
      </mat-card-header>

      <mat-card-content>
        <mat-tab-group [(selectedIndex)]="selectedTabIndex" class="settings-tabs">
          <!-- General Tab -->
          <mat-tab>
            <ng-template mat-tab-label>
              <mat-icon class="tab-icon">settings</mat-icon>
              General
            </ng-template>
            <div class="tab-content">
              <h3>General Settings</h3>

              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Language</mat-label>
                <mat-select [value]="language()" (valueChange)="updateLanguage($event)">
                  @for (lang of languages; track lang) {
                    <mat-option [value]="lang">{{ lang.toUpperCase() }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>

              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Theme</mat-label>
                <mat-select [value]="theme()" (valueChange)="updateTheme($event)">
                  @for (t of themes; track t) {
                    <mat-option [value]="t">{{ t | titlecase }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>

              <mat-checkbox
                [checked]="autoStart()"
                (change)="updateAutoStart($event.checked)"
                class="setting-checkbox"
              >
                Launch on system startup
              </mat-checkbox>

              <mat-checkbox
                [checked]="minimizeToTray()"
                (change)="updateMinimizeToTray($event.checked)"
                class="setting-checkbox"
              >
                Minimize to system tray
              </mat-checkbox>
            </div>
          </mat-tab>

          <!-- Stream Tab -->
          <mat-tab>
            <ng-template mat-tab-label>
              <mat-icon class="tab-icon">cast</mat-icon>
              Stream
            </ng-template>
            <div class="tab-content">
              <h3>Streaming Settings</h3>

              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Service</mat-label>
                <mat-select [value]="service()" (valueChange)="updateService($event)">
                  @for (s of services; track s) {
                    <mat-option [value]="s">{{ s | titlecase }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>

              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Server</mat-label>
                <input
                  matInput
                  [value]="streamServer()"
                  (input)="updateStreamServer($any($event.target).value)"
                  placeholder="rtmp://..."
                />
              </mat-form-field>

              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Stream Key</mat-label>
                <input
                  matInput
                  type="password"
                  [value]="streamKey()"
                  (input)="updateStreamKey($any($event.target).value)"
                  placeholder="Your stream key..."
                />
                <mat-hint>Keep your stream key private!</mat-hint>
              </mat-form-field>
            </div>
          </mat-tab>

          <!-- Output Tab -->
          <mat-tab>
            <ng-template mat-tab-label>
              <mat-icon class="tab-icon">output</mat-icon>
              Output
            </ng-template>
            <div class="tab-content">
              <h3>Output Settings</h3>

              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Encoder</mat-label>
                <mat-select [value]="encoder()" (valueChange)="updateEncoder($event)">
                  @for (enc of encoders; track enc) {
                    <mat-option [value]="enc">{{ enc.toUpperCase() }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>

              <div class="slider-setting">
                <label>Video Bitrate: {{ videoBitrate() }} kbps</label>
                <mat-slider min="1000" max="20000" step="500" showTickMarks discrete class="full-width">
                  <input matSliderThumb [value]="videoBitrate()" (valueChange)="updateVideoBitrate($event)" />
                </mat-slider>
              </div>

              <div class="slider-setting">
                <label>Audio Bitrate: {{ audioBitrate() }} kbps</label>
                <mat-slider min="64" max="320" step="32" showTickMarks discrete class="full-width">
                  <input matSliderThumb [value]="audioBitrate()" (valueChange)="updateAudioBitrate($event)" />
                </mat-slider>
              </div>

              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Recording Format</mat-label>
                <mat-select [value]="recordingFormat()" (valueChange)="updateRecordingFormat($event)">
                  @for (format of recordingFormats; track format) {
                    <mat-option [value]="format">{{ format.toUpperCase() }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>

              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Recording Path</mat-label>
                <input
                  matInput
                  [value]="recordingPath()"
                  (input)="updateRecordingPath($any($event.target).value)"
                />
              </mat-form-field>
            </div>
          </mat-tab>

          <!-- Video Tab -->
          <mat-tab>
            <ng-template mat-tab-label>
              <mat-icon class="tab-icon">videocam</mat-icon>
              Video
            </ng-template>
            <div class="tab-content">
              <h3>Video Settings</h3>

              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Base (Canvas) Resolution</mat-label>
                <mat-select [value]="baseResolution()" (valueChange)="updateBaseResolution($event)">
                  @for (res of resolutions; track res) {
                    <mat-option [value]="res">{{ res }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>

              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Output (Scaled) Resolution</mat-label>
                <mat-select [value]="outputResolution()" (valueChange)="updateOutputResolution($event)">
                  @for (res of resolutions; track res) {
                    <mat-option [value]="res">{{ res }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>

              <mat-form-field appearance="outline" class="full-width">
                <mat-label>FPS (Frames Per Second)</mat-label>
                <mat-select [value]="fps()" (valueChange)="updateFps($event)">
                  @for (f of frameRates; track f) {
                    <mat-option [value]="f">{{ f }} FPS</mat-option>
                  }
                </mat-select>
              </mat-form-field>

              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Downscale Filter</mat-label>
                <mat-select [value]="downscaleFilter()" (valueChange)="updateDownscaleFilter($event)">
                  @for (filter of filters; track filter) {
                    <mat-option [value]="filter">{{ filter | titlecase }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>
            </div>
          </mat-tab>

          <!-- Audio Tab -->
          <mat-tab>
            <ng-template mat-tab-label>
              <mat-icon class="tab-icon">audiotrack</mat-icon>
              Audio
            </ng-template>
            <div class="tab-content">
              <h3>Audio Settings</h3>

              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Sample Rate</mat-label>
                <mat-select [value]="sampleRate()" (valueChange)="updateSampleRate($event)">
                  @for (rate of sampleRates; track rate) {
                    <mat-option [value]="rate">{{ rate }} Hz</mat-option>
                  }
                </mat-select>
              </mat-form-field>

              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Channels</mat-label>
                <mat-select [value]="channels()" (valueChange)="updateChannels($event)">
                  @for (ch of channelOptions; track ch) {
                    <mat-option [value]="ch">{{ ch | titlecase }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>

              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Desktop Audio Device</mat-label>
                <mat-select [value]="desktopAudioDevice()" (valueChange)="updateDesktopAudioDevice($event)">
                  <mat-option value="default">Default</mat-option>
                  <mat-option value="disabled">Disabled</mat-option>
                </mat-select>
              </mat-form-field>

              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Microphone/Aux Device</mat-label>
                <mat-select [value]="micAudioDevice()" (valueChange)="updateMicAudioDevice($event)">
                  <mat-option value="default">Default</mat-option>
                  <mat-option value="disabled">Disabled</mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          </mat-tab>

          <!-- Hotkeys Tab -->
          <mat-tab>
            <ng-template mat-tab-label>
              <mat-icon class="tab-icon">keyboard</mat-icon>
              Hotkeys
            </ng-template>
            <div class="tab-content">
              <h3>Hotkeys</h3>
              <p>Configure keyboard shortcuts in the Hotkeys panel</p>
              <button mat-raised-button color="primary">
                <mat-icon>open_in_new</mat-icon>
                Open Hotkey Configuration
              </button>
            </div>
          </mat-tab>

          <!-- Advanced Tab -->
          <mat-tab>
            <ng-template mat-tab-label>
              <mat-icon class="tab-icon">construction</mat-icon>
              Advanced
            </ng-template>
            <div class="tab-content">
              <h3>Advanced Settings</h3>

              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Process Priority</mat-label>
                <mat-select [value]="processPriority()" (valueChange)="updateProcessPriority($event)">
                  @for (priority of priorities; track priority) {
                    <mat-option [value]="priority">{{ priority | titlecase }}</mat-option>
                  }
                </mat-select>
                <mat-hint>Changing priority can affect system stability</mat-hint>
              </mat-form-field>

              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Renderer</mat-label>
                <mat-select [value]="renderer()" (valueChange)="updateRenderer($event)">
                  @for (r of renderers; track r) {
                    <mat-option [value]="r">{{ r }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>

              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Color Format</mat-label>
                <mat-select [value]="colorFormat()" (valueChange)="updateColorFormat($event)">
                  @for (format of colorFormats; track format) {
                    <mat-option [value]="format">{{ format.toUpperCase() }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>

              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Color Space</mat-label>
                <mat-select [value]="colorSpace()" (valueChange)="updateColorSpace($event)">
                  @for (space of colorSpaces; track space) {
                    <mat-option [value]="space">{{ space }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>

              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Color Range</mat-label>
                <mat-select [value]="colorRange()" (valueChange)="updateColorRange($event)">
                  @for (range of colorRanges; track range) {
                    <mat-option [value]="range">{{ range | titlecase }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>
            </div>
          </mat-tab>

          <!-- AI Tab -->
          <mat-tab>
            <ng-template mat-tab-label>
              <mat-icon class="tab-icon">smart_toy</mat-icon>
              AI Features
            </ng-template>
            <div class="tab-content">
              <h3>AI Features</h3>
              <p>Configure AI-powered features in the AI Dashboard</p>
              <button mat-raised-button color="primary">
                <mat-icon>open_in_new</mat-icon>
                Open AI Dashboard
              </button>
            </div>
          </mat-tab>

          <!-- Cloud Tab -->
          <mat-tab>
            <ng-template mat-tab-label>
              <mat-icon class="tab-icon">cloud</mat-icon>
              Cloud & Sync
            </ng-template>
            <div class="tab-content">
              <h3>Cloud & Sync</h3>
              <p>Firebase authentication and cloud sync settings</p>
              <button mat-raised-button color="primary">
                <mat-icon>open_in_new</mat-icon>
                Manage Cloud Settings
              </button>
            </div>
          </mat-tab>
        </mat-tab-group>
      </mat-card-content>

      <mat-card-actions align="end" class="dialog-footer">
        @if (hasUnsavedChanges()) {
          <span class="unsaved-indicator">
            <mat-icon>error</mat-icon>
            Unsaved changes
          </span>
        }
        <button mat-button (click)="resetToDefaults()">
          Reset to Defaults
        </button>
        <button mat-button (click)="close()">
          Cancel
        </button>
        <button mat-raised-button color="primary" (click)="saveSettings()">
          <mat-icon>save</mat-icon>
          Save Settings
        </button>
      </mat-card-actions>
    </mat-card>
  </div>
}
